# タイガー＆ドラゴン 対戦サーバ/クライアント設計メモ

このドキュメントは、学習用エンジンとは別に、複数人対戦向けに必要なサーバ/クライアントの責務と構成を整理したものです。

## 方針
- 学習は通信なしの高速エンジンで行い、対戦時のみサーバを使用する。
- 対戦サーバは **engine の状態遷移/検証ルール** を利用し、学習と対戦のルール差異を防ぐ。
- ルールの一次資料は `RULES.md` に集約する。

## 対戦サーバの責務
- 接続管理（参加/切断/再接続）
- ルーム管理（人数、席順、開始条件）
- 対戦進行（ターン進行、攻め/受け/パス/1周ボーナス）
- 行動の検証（不正手や不整合の拒否）
- 状態配信（全プレイヤーへの最新状態通知）
- ログ/リプレイ用の履歴保存

## クライアントの責務
- UI表示（手牌、攻め/受け列、ターン表示）
- 入力処理（攻め・受け・パスの選択）
- 通信（サーバとのメッセージ送受信）
- ローカルの補助（入力バリデーション、演出）

## サーバ構成案
- `net/` : 接続とメッセージ送受信
- `lobby/` : ルーム管理と参加制御
- `match/` : 対戦状態の管理と進行
- `rules/` : `engine` を利用した検証
- `log/` : 対戦ログ/リプレイ

## クライアント構成案
- `net/` : 通信層（接続/再接続/受信キュー）
- `ui/` : 画面表示
- `input/` : 操作入力
- `state/` : クライアント表示用状態

## 最小メッセージ案
- `join_room` : ルーム参加
- `start_game` : ゲーム開始通知
- `action` : 攻め/受け/パス/ボーナス選択
- `state` : 状態更新
- `end_game` : ゲーム終了通知
